name: Sentry release version bump

on:
  push:
    branches:
      - master

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - name: Create new sentry release
        run: |
          git fetch --depth=1 origin +refs/tags/*:refs/tags/*
          git tag -l --points-at HEAD
          git tag -l --points-at HEAD | grep -e '^v\d*_\d*_\d*_\d*$'
          git tag -l --points-at HEAD | grep -e '^v\d*_\d*_\d*_\d*$' | cut -c 2-
          TAGS=$(git tag -l --points-at HEAD)
          echo "$TAGS"
          MATCHING=$(echo $TAGS | grep -e '^v\d*_\d*_\d*_\d*$')
          echo "$MATCHING"
          SENTRY_RELEASE=$(git tag -l --points-at HEAD | grep -e '^v\d*_\d*_\d*_\d*$' | cut -c 2-)
          echo "$SENTRY_RELEASE"
